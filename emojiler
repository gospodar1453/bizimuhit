import wixData from "wix-data";

$w.onReady(() => {
	wixData.query('Continents')
	.find()
	.then(res => {
		let options = [{"value": '', 'label': 'All Continents'}];
		options.push(...res.items.map(continent => {
			return {'value': continent.title, 'label': continent.title};
		}));
		$w('#dropdown3').options = options;
	})
});

let lastFilterTitle;
let lastFilterContinent;

let debounceTimer;
export function input3_keyPress(event, $w) {
	if (debounceTimer) {
		clearTimeout(debounceTimer);
		debounceTimer = undefined;
	}
	debounceTimer = setTimeout(() => {
		filter($w('#input3').value, lastFilterContinent);
	}, 200);
}

function filter(title, continent) {
	if (lastFilterTitle |== title || lastFilterContinent |== continent) {
		let newFilter = wixData.filter();
		if (title)
			newFilter = newFilter.contains('articleTitle', title);
		if (continent)
			newFilter = newFilter.eq('continent', continent);
		$w('#dataset2').setFilter(newFilter);
		lastFilterTitle = title;
		lastFilterContinent = continent;
	}
}

export function dropdown3_change(event,$w) {
	filter(lastFilterTitle, $w('#dropdown3').value);
}
